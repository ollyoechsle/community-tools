console.log("Welcome to Yaxham!"),window.yaxham=window.yaxham||{},window.yaxham.modules=window.yaxham.modules||{},function(){function e(e){this.jElement=e,this.initialise()}e.prototype=Object.create(Subscribable.prototype),e.prototype.initialise=function(){this.jElement.html(e.HTML),this.jElement.delegate(".arrow.enabled","click",this.handleClick.bind(this))},e.prototype.handleClick=function(e){var t=jQuery(e.currentTarget);t.hasClass("left")?this.fire("changed",this.selectedIndex-1):this.fire("changed",this.selectedIndex+1)},e.prototype.empty=function(){this.jElement.css("visibility","hidden")},e.prototype.render=function(e,t){this.jElement.css("visibility","visible");var n=e[t].label;this.jElement.find(".value").html(n),this.jElement.find(".left").toggleClass("enabled",t>0),this.jElement.find(".right").toggleClass("enabled",t<e.length-1),this.selectedIndex=t},e.HTML='<div class="hselector"><div class="arrow left">&#8592;</div><div class="value"></div><div class="arrow right">&#8594;</div></div>',window.HSelector=e}(),function(){function e(e,t){this.intervals=[],this.view=e,this.model=t}e.prototype.initialise=function(){this.load(),this.intervals.push(setInterval(this.view.updateAll.bind(this.view),1e4)),this.intervals.push(setInterval(this.load.bind(this),6e5)),this.view.updateAll(),this.view.on("changed",this.handleModelChanged.bind(this))},e.prototype.handleModelChanged=function(){this.model.data=null,this.load(),this.view.updateAll()},e.prototype.load=function(){var t={url:e.URL,dataType:"jsonp",data:{stop:this.model.getFirstStop().NaptanCode}},n=jQuery.ajax(t);n.then(this.handleLoad.bind(this))},e.prototype.handleLoad=function(e){this.model.data=e,this.view.updateAll()},e.prototype.destroy=function(){this.intervals.forEach(function(e){window.clearInterval(e)}),this.view.destroy()},e.URL="http://community-tools.appspot.com/buses",yaxham.modules.BusDeparturesController=e}(),function(){function e(e){this.view=e,this.locationIndex=0,this.direction="dereham"}function t(e,t){return t<5}e.locationIndex=null,e.direction=null,e.data=null,e.prototype.hasData=function(){return!!this.data},e.prototype.getDepartures=function(){var e=this.getStop().delta;return this.data.filter(t).map(function(t){var n=t.estimated||t.scheduled,r=moment().eod().format(),i=moment(n).add("s",e),s=i.diff(r)>0,o=moment().add("m",5),u=i.diff(o)<0,a=s?"ddd HH:mm":"HH:mm";return{destination:t.destination,service:t.service,timestamp:n,time:i.format(a),inTime:i.fromNow(),className:u?"iminent":""}})},e.prototype.getDirections=function(){return e.DIRECTIONS.map(function(e){return{direction:e.direction,label:e.label,className:e.direction==this.direction?"selected":""}}.bind(this))},e.prototype.getStop=function(){return e.LOCATIONS[this.locationIndex][this.direction]},e.prototype.getFirstStop=function(){return e.LOCATIONS[0][this.direction]},e.prototype.getAllStopsInDirection=function(t){return e.LOCATIONS.map(function(e,t){var n=e[this.direction];return{label:n.CommonName,locationIndex:t}}.bind(this))},e.prototype.firstDepartureAlreadyLeft=function(){if(this.data.length){var e=this.data[0],t=e.estimated||e.scheduled,n=moment(t).diff(moment())<0;if(n)return this.data.unshift(),!0}return!1},e.DIRECTIONS=[{direction:"dereham",label:"To Dereham"},{direction:"norwich",label:"To Norwich"}],e.LOCATIONS=[{dereham:{NaptanCode:"nfogpdjd",CommonName:"Station Road",Landmark:"",Street:"Dereham Road",Indicator:"adj",LocalityName:"Yaxham",Longitude:.96207,Latitude:52.65608,delta:0},norwich:{NaptanCode:"nfogmtdw",CommonName:"Station Road",Landmark:"Station Road",Street:"Dereham Road",Indicator:"opp",LocalityName:"Yaxham",Longitude:.96239,Latitude:52.65583,delta:0}},{dereham:{NaptanCode:"nfogjmpt",CommonName:"Bus Shelter",Landmark:"The Rosary",Street:"Norwich Road",Indicator:"adj",LocalityName:"Yaxham",Longitude:.96479,Latitude:52.6557,delta:-30},norwich:{NaptanCode:"nfogjmta",CommonName:"Bus Shelter",Landmark:"The Rosary",Street:"Norwich Road",Indicator:"opp",LocalityName:"Yaxham",Longitude:.96461,Latitude:52.65584,delta:30}},{dereham:{NaptanCode:"nfogjmtj",CommonName:"Elm Close",Landmark:"Elm Close",Street:"Norwich Road",Indicator:"adj",LocalityName:"Yaxham",Longitude:.96829,Latitude:52.65514,delta:-180},norwich:{NaptanCode:"nfogjmtg",CommonName:"Elm Close",Landmark:"St. Peters Close",Street:"Norwich Road",Indicator:"opp",LocalityName:"Yaxham",Longitude:.9689,Latitude:52.65518,delta:60}},{dereham:{NaptanCode:"nfogjmtd",CommonName:"Well Hill",Landmark:"Well Hill",Street:"Norwich Road",Indicator:"adj",LocalityName:"Clint Green",Longitude:.98847,Latitude:52.65877,delta:-240},norwich:{NaptanCode:"nfogjmpw",CommonName:"Well Hill",Landmark:"Well Hill",Street:"Norwich Road",Indicator:"opp",LocalityName:"Clint Green",Longitude:.98935,Latitude:52.65937,delta:120}}],yaxham.modules.BusDeparturesModel=e}(),function(){function e(e,t){this.jElement=jQuery(e);if(this.jElement.length==0)throw new Error("Invalid selector: "+e);this.model=t,this.initialise()}e.prototype=Object.create(Subscribable.prototype),e.prototype.jElement=null,e.prototype.jBoard=null,e.prototype.selector=null,e.prototype.initialise=function(){this.jElement.append(e.MARKUP),this.jBoard=this.jElement.find(".board"),this.selector=new HSelector(this.jElement.find(".otherStops")),this.jElement.delegate(".tabs li:not(.selected)","click",this.handleTabClick.bind(this)),this.selector.on("changed",this.handleStopClick.bind(this))},e.prototype.handleTabClick=function(e){var t=jQuery(e.currentTarget);this.model.direction=t.data("direction"),this.fire("changed")},e.prototype.handleStopClick=function(e){this.model.locationIndex=e,this.updateAll()},e.prototype.updateAll=function(){var t=Mustache.to_html(e.TABS,{list:this.model.getDirections()});this.jElement.find(".tabs").html(t),this.selector.render(this.model.getAllStopsInDirection(),this.model.locationIndex),this.model.hasData()?this.displayBoard():this.displayLoading()},e.prototype.displayLoading=function(){this.jBoard.empty().addClass("loading"),this.selector.empty()},e.prototype.displayBoard=function(){var t={list:this.model.getDepartures()},n=Mustache.to_html(e.LIST,t);this.jBoard.removeClass("loading").html(n),this.model.firstDepartureAlreadyLeft()&&this.jElement.find("tbody tr").eq(0).fadeOut()},e.prototype.destroy=function(){this.jElement.undelegate()},e.LIST='<table class="table"><thead><tr><th class="service">Service</th><th>To</th><th>Departs</th><th></th></tr></thead><tbody>{{#list}}<tr class="{{className}}"><td class="service">{{service}}</td><td>{{destination}}</td><td class="time"><time datetime="{{timestamp}}">{{time}}</time></td><td class="inTime">{{inTime}}</td></tr>{{/list}}</tbody></table>',e.MARKUP='<h2>Bus Departures</h2><ul class="tabs"></ul><div class="otherStops"></div><div class="board"></div>',e.TABS='{{#list}}<li data-direction="{{direction}}" class="{{className}}">{{label}}</li>{{/list}}',e.SELECT='<select>{{#list}}<option value="{{locationIndex}}">{{label}}</option>{{/list}}</select>',yaxham.modules.BusDeparturesView=e}(),function(){yaxham.modules.Buses=function(e){var t=new yaxham.modules.BusDeparturesModel,n=new yaxham.modules.BusDeparturesView(e,t),r=new yaxham.modules.BusDeparturesController(n,t);return r}}(),function(){function e(e,t){this.intervals=[],this.view=e,this.model=t}e.prototype.initialise=function(){this.load(),this.intervals.push(setInterval(this.load.bind(this),3e5)),this.view.updateAll()},e.prototype.load=function(){var t={url:e.URL,dataType:"jsonp"},n=jQuery.ajax(t);n.then(this.handleLoad.bind(this))},e.prototype.handleLoad=function(e){this.model.setAllData(e),this.view.updateAll()},e.prototype.destroy=function(){this.intervals.forEach(function(e){window.clearInterval(e)}),this.view.destroy()},e.URL="http://community-tools.appspot.com/weather",yaxham.modules.WeatherController=e}(),function(){function e(e){this.view=e,this.locationIndex=0}e.locationIndex=null,e.direction=null,e.data=null,e.prototype.hasData=function(){return!!this.data},e.prototype.setAllData=function(e){this.data=e,this.location=e.SiteRep.DV.Location},e.prototype.getForecast=function(){return this.location.Period[0].Rep.map(function(t){return{type:e.WEATHER[t.W].name,icon:e.WEATHER[t.W].img,chanceOfRain:t.Pp,temperature:t.T,windSpeed:t.S,windDirection:t.D,time:e.timeOfReading[t.$]}})},e.timeOfReading={0:"0:00",180:"03:00",360:"06:00",540:"09:00",720:"12:00",900:"15:00",1080:"18:00",1260:"21:00"},e.WEATHER={NA:{Name:"Not Available",img:""},0:{Name:"Clear night",img:"01n.png"},1:{Name:"Sunny day",img:"01d.png"},2:{Name:"Partly cloudy",img:"01n.png"},3:{Name:"Partly cloudy",img:"01d.png"},5:{Name:"Mist",img:"15.png"},6:{Name:"Fog",img:"15.png"},7:{Name:"Cloudy",img:"04.png"},8:{Name:"Overcast",img:"04.png"},9:{Name:"Light rain shower",img:"05n.png"},10:{Name:"Light rain shower",img:"05d.png"},11:{Name:"Drizzle",img:"09.png"},12:{Name:"Light rain",img:"09.png"},13:{Name:"Heavy rain shower",img:"10.png"},14:{Name:"Heavy rain shower",img:"10.png"},15:{Name:"Heavy rain",img:"10.png"},16:{Name:"Sleet shower",img:"12.png"},17:{Name:"Sleet shower",img:"12.png"},18:{Name:"Sleet",img:"12.png"},19:{Name:"Hail shower",img:"08d.png"},20:{Name:"Hail shower",img:"08n.png"},21:{Name:"Hail",img:"08d.png"},22:{Name:"Light snow shower",img:"08d.png"},23:{Name:"Light snow shower",img:"08n.png"},24:{Name:"Light snow",img:"08d.png"},25:{Name:"Heavy snow shower",img:"13.png"},26:{Name:"Heavy snow shower",img:"13.png"},27:{Name:"Heavy snow",img:"13.png"},28:{Name:"Thunder shower",img:"11.png"},29:{Name:"Thunder shower",img:"11.png"},30:{Name:"Thunder",img:"11.png"}},yaxham.modules.WeatherModel=e}(),function(){function e(e,t){this.jElement=jQuery(e);if(this.jElement.length==0)throw new Error("Invalid selector: "+e);this.model=t,this.initialise()}e.prototype=Object.create(Subscribable.prototype),e.prototype.jElement=null,e.prototype.initialise=function(){this.jElement.append(e.MARKUP)},e.prototype.updateAll=function(){this.model.hasData()?this.displayBoard():this.displayLoading()},e.prototype.displayLoading=function(){this.jElement.find("currentConditions").empty().addClass("loading")},e.prototype.displayBoard=function(){var t=this.model.getForecast(),n=t[0],r=t.filter(function(e,t){return t>0&&t<6});this.jElement.find(".currentConditions").html(Mustache.to_html(e.CURRENT_CONDITIONS,n)),this.jElement.find(".laterConditions").html(Mustache.to_html(e.LATER_CONDITIONS,{forecasts:r}))},e.prototype.destroy=function(){},e.CURRENT_CONDITIONS='<img class="icon" src="img/weather/icons_120x100/{{icon}}"/><ul><li><div class="weatherType">{{type}}</div><div class="temperature">{{temperature}}&deg;C</div></li><li class="otherDetails"><div class="heading">Rain</div><div class="rainChance reading">{{chanceOfRain}}%</div><div class="heading">Wind</div><div class="windSpeed reading">{{windSpeed}} mph {{windDirection}}</div></li></ul>',e.LATER_CONDITIONS='{{#forecasts}}<li><td><img src="/static/img/weather/icons_60x50/{{icon}}" /></td><div class="time heading">{{time}}</div><div class="temperature reading">{{temperature}}&deg;C</div></li>{{/forecasts}}',e.MARKUP='<h2>Yaxham Weather Station</h2><div class="weather"><div class="currentConditions"></div><ul class="laterConditions"></ul><p class="attribution">Data: <a href="http://www.metoffice.gov.uk/public/weather/forecast/dereham">Met Office</a></p></div>',yaxham.modules.WeatherView=e}(),function(){yaxham.modules.Weather=function(e){var t=new yaxham.modules.WeatherModel,n=new yaxham.modules.WeatherView(e,t),r=new yaxham.modules.WeatherController(n,t);return r}}();