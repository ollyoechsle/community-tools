console.log("Welcome to Yaxham!"),window.yaxham=window.yaxham||{},window.yaxham.modules=window.yaxham.modules||{},function(){function e(e,t){this.intervals=[],this.view=e,this.model=t}e.prototype.initialise=function(){this.load(),this.intervals.push(setInterval(this.view.updateAll.bind(this.view),1e4)),this.intervals.push(setInterval(this.load.bind(this),3e5)),this.view.updateAll()},e.prototype.load=function(){console.log("Starting to load...");var t={url:e.URL,dataType:"jsonp"},n=jQuery.ajax(t);n.then(this.handleLoad.bind(this))},e.prototype.handleLoad=function(e){console.log("Finished loading"),this.model.data=e,this.view.updateAll()},e.prototype.destroy=function(){this.intervals.forEach(function(e){window.clearInterval(e)})},e.URL="http://community-tools.appspot.com/buses",yaxham.modules.BusDeparturesController=e}(),function(){function e(e){this.intervals=[],this.view=e}function t(e){var t=e.estimated||e.scheduled,n=moment().eod().format(),r=moment(t),i=r.diff(n)>0,s=moment().add("m",5),o=r.diff(s)<0,u=i?"ddd HH:mm":"HH:mm";return{destination:e.destination,service:e.service,timestamp:t,time:r.format(u),inTime:r.fromNow(),className:o?"iminent":""}}e.data=null,e.prototype.hasData=function(){return!!this.data},e.prototype.getDepartures=function(){return this.data.map(t)},e.prototype.firstDepartureAlreadyLeft=function(){if(this.data.length){var e=this.data[0],t=e.estimated||e.scheduled,n=moment(t).diff(moment())<0;if(n)return this.data.unshift(),!0}return!1},yaxham.modules.BusDeparturesModel=e}(),function(){function e(t,n){this.jElement=jQuery(t);if(this.jElement.length==0)throw new Error("Invalid selector: "+t);this.jElement.html(e.MARKUP),this.jBoard=this.jElement.find(".board"),this.model=n,this.intervals=[],console.log("Buses, initialised with board ",this.jBoard)}e.prototype.updateAll=function(){this.model.hasData()?this.displayBoard():this.displayLoading()},e.prototype.displayLoading=function(){console.log("Loading..."),this.jBoard.addClass("loading").html("Loading live bus departures...")},e.prototype.displayBoard=function(){console.log("Displaying board...");var t={list:this.model.getDepartures()},n=Mustache.to_html(e.LIST,t);this.jBoard.removeClass("loading").html(n),this.model.firstDepartureAlreadyLeft()&&this.jElement.find("tbody tr").eq(0).fadeOut()},e.LIST='<table class="table"><thead><tr><th class="service">Service</th><th>To</th><th>Departs</th><th></th></tr></thead><tbody>{{#list}}<tr class="{{className}}"><td class="service">{{service}}</td><td>{{destination}}</td><td class="time"><time datetime="{{timestamp}}">{{time}}</time></td><td class="inTime">{{inTime}}</td></tr>{{/list}}</tbody></table>',e.MARKUP='<h2>Bus Departures</h2><ul class="tabs"><li class="selected">To Dereham</li><li>To Norwich</li></ul><div class="board"></div>',yaxham.modules.BusDeparturesView=e}(),function(){yaxham.modules.Buses=function(e){var t=new yaxham.modules.BusDeparturesModel,n=new yaxham.modules.BusDeparturesView(e,t),r=new yaxham.modules.BusDeparturesController(n,t);return r}}();