console.log("Welcome to Yaxham!"),window.yaxham=window.yaxham||{},window.yaxham.modules=window.yaxham.modules||{},function(){function e(t){this.jElement=jQuery(t);if(this.jElement.length==0)throw new Error("Invalid selector: "+t);this.jElement.html(e.MARKUP),this.jBoard=this.jElement.find(".board"),this.intervals=[],console.log("Buses, initialised with board ",this.jBoard)}function t(e){var t=e.estimated||e.scheduled,n=moment().eod().format(),r=moment(t),i=r.diff(n)>0,s=moment().add("m",5),o=r.diff(s)<0,u=i?"ddd HH:mm":"HH:mm";return{destination:e.destination,service:e.service,timestamp:t,time:r.format(u),inTime:r.fromNow(),className:o?"iminent":""}}e.prototype.initialise=function(){this.load(),this.intervals.push(setInterval(this.updateAll.bind(this),1e4)),this.intervals.push(setInterval(this.load.bind(this),3e5)),this.updateAll()},e.prototype.load=function(){console.log("Starting to load...");var t={url:e.URL,dataType:"jsonp"},n=jQuery.ajax(t);n.then(this.handleLoad.bind(this))},e.prototype.handleLoad=function(e){console.log("Finished loading"),this.data=e,this.updateAll()},e.prototype.updateAll=function(){this.data?this.displayBoard():this.displayLoading()},e.prototype.displayLoading=function(){console.log("Loading..."),this.jBoard.addClass("loading").html("Loading live bus departures...")},e.prototype.displayBoard=function(){console.log("Displaying board...");var n=mustache.to_html(e.LIST,{list:this.data.map(t)});this.jBoard.removeClass("loading").html(n);if(this.data.length){var r=this.data[0],i=r.estimated||r.scheduled,s=moment(i).diff(moment())<0;s&&(this.jElement.find("tbody tr").eq(0).fadeOut(),this.data.unshift())}},e.prototype.destroy=function(){this.intervals.forEach(function(e){window.clearInteval(e)})},e.LIST='<table class="table"><thead><tr><th class="service">Service</th><th>To</th><th>Departs</th><th></th></tr></thead><tbody>{{#list}}<tr class="{{className}}"><td class="service">{{service}}</td><td>{{destination}}</td><td class="time"><time datetime="{{timestamp}}">{{time}}</time></td><td class="inTime">{{inTime}}</td></tr>{{/list}}</tbody></table>',e.MARKUP='<h2>Bus Departures</h2><ul class="tabs"><li class="selected">To Dereham</li><li>To Norwich</li></ul><div class="board"></div>',e.URL="http://community-tools.appspot.com/buses",yaxham.modules.Buses=e}();