console.log("Welcome to Yaxham!"),window.yaxham=window.yaxham||{},window.yaxham.modules=window.yaxham.modules||{};var Subscribable=function(){"use strict";function e(){}return e.prepareInstance=function(t){t.__events={},t.__handlers=[],t.on=e.on,t.un=e.un,t.fire=e.fire,t.hasListener=e.hasListener},e.prototype.__events=null,e.prototype.__handlers=null,e.prototype.on=function(){return e.prepareInstance(this),this.on.apply(this,arguments)},e.prototype.un=function(){return this},e.prototype.fire=function(){return!0},e.prototype.hasListener=function(e){return!1},e.fire=function(t){var n,r,i,s,o,u;typeof t=="object"&&(s=[t],t=t.constructor.toString()),u=e._getHandlersList(this,t,!1);if(u&&u.length){s=s||Array.prototype.slice.call(arguments,1);for(i,n=0,r=u.length;n<r&&i!==!1;n++)if(o=this.__handlers[u[n]])i=o[0].apply(o[1],s);return i!==!1}return!0},e._getHandlersList=function(e,t,n){return t=(""+t).toLowerCase(),!e.__events[t]&&n&&(e.__events[t]=[]),e.__events[t]},e._saveHandler=function(e,t,n,r){var i=e.__handlers.length;return e.__handlers.push([t,n,i]),r.push(i),i},e.on=function(t,n,r){return e._saveHandler(this,n,r,e._getHandlersList(this,t,!0))},e.un=function(t,n){var r=typeof t;switch(r){case"number":e.removeSingleEvent(this,t,n);break;case"string":case"function":t=(""+t).toLowerCase(),e.removeMultipleEvents(this,e._getHandlersList(this,t,!1),n),n&&e.consolidateEvents(this,t);break;default:t?(e.removeMultipleHandlers(this,this.__handlers,t||null),e.consolidateEvents(this)):(this.__handlers=[],this.__events={})}},e.consolidateEvents=function(t,n){if(!arguments.length)for(var n in t.__events)e.consolidateEvents(n);var r=t.__events[n];if(r&&r.length)for(var i=r.length-1;i>=0;i--)t.__handlers[r[i]]||r.splice(i,1);r&&!r.length&&delete t.__events[n]},e.removeMultipleEvents=function(t,n,r){for(var i=0,s=n.length;i<s;i++)e.removeSingleEvent(t,n[i],r)},e.removeMultipleHandlers=function(t,n,r){var i;for(var s=0,o=n.length;s<o;s++)(i=n[s])&&e.removeSingleEvent(t,i[2],r)},e.removeSingleEvent=function(e,t,n){e.__handlers[t]&&(!n||e.__handlers[t][1]===n)&&(e.__handlers[t]=null)},e.hasListener=function(e){var t,n,r,i;if(e===undefined){t=this.__handlers;for(r=0,i=t.length;r<i;r++)if(!!t[r])return!0}else if(n=this.__events[(""+e).toLowerCase()])for(var r=0,i=n.length;r<i;r++)if(this.__handlers[n[r]])return!0;return!1},e}();typeof module!="undefined"&&(module.exports=Subscribable),function(){function e(e,t){this.intervals=[],this.view=e,this.model=t}e.prototype.initialise=function(){this.load(),this.intervals.push(setInterval(this.load.bind(this),3e5)),this.view.updateAll()},e.prototype.load=function(){var t={url:e.URL+"/weather",dataType:"jsonp"},n=jQuery.ajax(t);n.then(this.handleLoad.bind(this))},e.prototype.handleLoad=function(e){this.model.setAllData(e),this.view.updateAll()},e.prototype.destroy=function(){this.intervals.forEach(function(e){window.clearInterval(e)}),this.view.destroy()},e.URL="http://community-tools.appspot.com",yaxham.modules.WeatherController=e}(),function(){function e(){this.currentIndex=0}e.prototype=Object.create(Subscribable.prototype),e.currentIndex=0,e.direction=null,e.data=null,e.prototype.hasData=function(){return!!this.data},e.prototype.setAllData=function(e){this.data=e;var t=e.SiteRep.DV.Location.Period,n=[];t.forEach(function(e){var t=moment(e.value).format("ddd");for(var r=0;r<e.Rep.length;r++)e.Rep[r].day=t,n.push(e.Rep[r])}),this.allPeriods=n},e.prototype.changeCurrentIndex=function(e){this.currentIndex+=e,this.currentIndex=Math.max(0,this.currentIndex),this.currentIndex=Math.min(this.currentIndex,this.allPeriods.length-1),this.fire("indexChanged")},e.prototype.hasPrev=function(){return this.currentIndex>0},e.prototype.hasNext=function(){return this.currentIndex<this.allPeriods.length-1},e.prototype.getForecast=function(){var t=this.currentIndex;return this.allPeriods.map(function(n,r){return{className:r==t?"current":"notCurrent",type:e.WEATHER[n.W].name,icon:e.WEATHER[n.W].img,chanceOfRain:n.Pp,temperature:n.T,windSpeed:n.S,windDirection:n.D,time:e.timeOfReading[n.$],day:n.day}})},e.prototype.getTemperatureRange=function(){var e=this.allPeriods.map(function(e){return e.T});return{max:Math.max.apply(null,e),min:Math.min.apply(null,e)}},e.timeOfReading={0:"0:00",180:"03:00",360:"06:00",540:"09:00",720:"12:00",900:"15:00",1080:"18:00",1260:"21:00"},e.WEATHER={NA:{name:"Not Available",img:""},0:{name:"Clear",img:"01n.png"},1:{name:"Sunny",img:"01d.png"},2:{name:"Partly cloudy",img:"01n.png"},3:{name:"Partly cloudy",img:"01d.png"},5:{name:"Mist",img:"15.png"},6:{name:"Fog",img:"15.png"},7:{name:"Cloudy",img:"04.png"},8:{name:"Overcast",img:"04.png"},9:{name:"Light rain shower",img:"05n.png"},10:{name:"Light rain shower",img:"05d.png"},11:{name:"Drizzle",img:"09.png"},12:{name:"Light rain",img:"09.png"},13:{name:"Heavy rain shower",img:"10.png"},14:{name:"Heavy rain shower",img:"10.png"},15:{name:"Heavy rain",img:"10.png"},16:{name:"Sleet shower",img:"12.png"},17:{name:"Sleet shower",img:"12.png"},18:{name:"Sleet",img:"12.png"},19:{name:"Hail shower",img:"08d.png"},20:{name:"Hail shower",img:"08n.png"},21:{name:"Hail",img:"08d.png"},22:{name:"Light snow shower",img:"08d.png"},23:{name:"Light snow shower",img:"08n.png"},24:{name:"Light snow",img:"08d.png"},25:{name:"Heavy snow shower",img:"13.png"},26:{name:"Heavy snow shower",img:"13.png"},27:{name:"Heavy snow",img:"13.png"},28:{name:"Thunder shower",img:"11.png"},29:{name:"Thunder shower",img:"11.png"},30:{name:"Thunder",img:"11.png"}},yaxham.modules.WeatherModel=e}(),function(){function e(e,t){this.jElement=jQuery(e);if(this.jElement.length==0)throw new Error("Invalid selector: "+e);this.model=t,this.initialise()}e.prototype=Object.create(Subscribable.prototype),e.prototype.jElement=null,e.prototype.initialise=function(){this.jElement.append(e.MARKUP).delegate(".btn","click.weather",this.handleNavigate.bind(this)),this.model.on("indexChanged",this.updateAll,this)},e.prototype.handleNavigate=function(e){var t=jQuery(e.currentTarget),n=t.data("direction");this.model.changeCurrentIndex(+n)},e.prototype.updateAll=function(){this.model.hasData()?this.displayBoard():this.displayLoading()},e.prototype.displayLoading=function(){this.jElement.find("currentConditions").empty().addClass("loading")},e.prototype.displayBoard=function(){var t=this.model.currentIndex,n=this.model.getForecast(),r=n[t],i=n.filter(function(e,n){return n>=t&&n<t+4});this.jElement.find(".currentConditions").html(Mustache.to_html(e.CURRENT_CONDITIONS,r)),this.jElement.find(".laterConditions").html(Mustache.to_html(e.LATER_CONDITIONS,{forecasts:i}))},e.prototype.destroy=function(){this.jElement.undelegate(".weather"),this.model.un(null,this)},e.CURRENT_CONDITIONS='<img class="icon" width="60" height="50" src="http://dev.yaxham.com:8083/static/img/weather/icons_120x100/{{icon}}"/><ul><li><div class="weatherType">{{type}}</div><div class="temperature">{{temperature}}&deg;C</div></li><li class="otherDetails"><div class="heading">Rain</div><div class="rainChance reading">{{chanceOfRain}}%</div><div class="heading">Wind</div><div class="windSpeed reading">{{windSpeed}} mph {{windDirection}}</div></li></ul>',e.LATER_CONDITIONS='{{#forecasts}}<li class="{{className}}"><td><img width="30" height="25" src="http://dev.yaxham.com:8083/static/img/weather/icons_60x50/{{icon}}" /></td><div class="time heading">{{time}}</div><div class="temperature reading">{{temperature}}&deg;C</div></li>{{/forecasts}}',e.MARKUP='<div class="weather vertical"><div class="currentConditions"></div><div class="navigator"><div class="btn prev" data-direction="-1"></div><ul class="laterConditions"></ul><div class="btn next" data-direction="+1"></div></div><p class="attribution">Data: <a href="http://www.metoffice.gov.uk/public/weather/forecast/dereham">Met Office</a></p></div>',yaxham.modules.WeatherView=e}(),function(){function e(e,t){return e.hasClass("horizontal")?new yaxham.modules.WeatherChartView(e,t):new yaxham.modules.WeatherView(e,t)}yaxham.modules.Weather=function(t){jQuery(t).each(function(){var t=new yaxham.modules.WeatherModel,n=e(jQuery(this),t),r=new yaxham.modules.WeatherController(n,t);r.initialise()})}}(),function(){function e(e,t){this.jElement=jQuery(e);if(this.jElement.length==0)throw new Error("Invalid selector: "+e);this.model=t,this.initialise()}e.prototype=Object.create(Subscribable.prototype),e.prototype.jElement=null,e.prototype.initialise=function(){this.jElement.append(e.MARKUP).delegate(".btn","click.weather",this.handleNavigate.bind(this)),this.weatherChart=new yaxham.modules.WeatherChart(this.jElement.find(".navigator")),this.model.on("indexChanged",this.updateAll,this)},e.prototype.handleNavigate=function(e){var t=jQuery(e.currentTarget),n=t.data("direction");this.model.changeCurrentIndex(+n)},e.prototype.updateAll=function(){this.model.hasData()?this.displayBoard():this.displayLoading()},e.prototype.displayLoading=function(){this.jElement.find("currentConditions").empty().addClass("loading")},e.prototype.displayBoard=function(){var t=this.model.currentIndex,n=this.model.getForecast().filter(function(e,n){return n>=t&&n<t+16}),r=this.model.getTemperatureRange(),i=r.max-r.min;n.forEach(function(e){var t=(e.temperature-r.min)/i*50;e.top=50-t,e.className=e.time=="0:00"?"startOfDay":"",e.time=e.time=="0:00"?e.day+"<br>"+e.time:"<br>"+e.time}),this.weatherChart.render(n),this.jElement.find(".laterConditions").html(Mustache.to_html(e.LATER_CONDITIONS,{forecasts:n}))},e.prototype.destroy=function(){this.jElement.undelegate(".weather"),this.model.un(null,this)},e.LATER_CONDITIONS='{{#forecasts}}<li class="{{className}}"><div class="time heading">{{{time}}}</div><div class="precipitation" style="height: {{chanceOfRain}}px"></div><div class="fc" style="top: {{top}}px"><img width="30" height="25" src="/static/img/weather/icons_60x50/{{icon}}" /><div class="temperature reading">{{temperature}}&deg;C</div></div></li>{{/forecasts}}',e.MARKUP='<div class="weather horizontal"><div class="navigator"><div class="btn prev" data-direction="-1"></div><ul class="laterConditions"></ul><div class="btn next" data-direction="+1"></div></div><p class="attribution">Data: <a href="http://www.metoffice.gov.uk/public/weather/forecast/dereham">Met Office</a></p></div>',yaxham.modules.WeatherChartView=e}(),function(e){function t(t){this.jContainer=e(t),this.initialise()}t.prototype.jContainer=null,t.prototype.ctx=null,t.prototype.getCanvas=function(){var e=document.createElement("canvas");return e.width=this.jContainer.width()||160,e.height=this.jContainer.height()||160,this.jContainer[0].appendChild(e),window.G_vmlCanvasManager?window.G_vmlCanvasManager.initElement(e):e},t.prototype.initialise=function(){var e=this.getCanvas();this.ctx=e.getContext("2d")},t.prototype.render=function(e){var n=this.ctx,r=36,i=0;n.clearRect(0,0,1e3,500),this.setStroke(t.NOTCH),n.beginPath(),n.moveTo(i,e.top+2);for(var s=0;s<20&&s<e.length;s++)n.lineTo(i,e[s].top+2),i+=r;n.stroke()},t.prototype.setStroke=function(e){this.ctx.lineWidth=e["stroke-width"],this.ctx.strokeStyle=e.stroke},t.NOTCH={stroke:"#ccc","stroke-width":2},yaxham.modules.WeatherChart=t}(window.jQuery);